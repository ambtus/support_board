<% if params[:by_vote] %>
  <%= link_to "Sort by position", code_tickets_path(params.merge :by_vote => false) %>
<% else %>
  <%= link_to "Sort by vote count", code_tickets_path(params.merge :by_vote => true) %>
<% end %>

<%= form_tag '/code_tickets', :method => :get do %>
  <%= label_tag :status %>
  <%= select_tag :status,
                 options_for_select([:open, :all] + CodeTicket.workflow_spec.state_names, params[:status]) %>
  <%= label_tag :owned_by_support_identity %>
  <%= select_tag :owned_by_support_identity, "<option></option>".html_safe +
                 options_from_collection_for_select(SupportIdentity.official.all, "name", "name", params[:owned_by_support_identity]) %>
  <%= label_tag :user %>
  <%= text_field_tag :user, params[:user] %>
  <%= label_tag :comments_by_support_identity, "With comments by"  %>
  <%= text_field_tag :comments_by_support_identity, params[:comments_by_support_identity] %>
  <%= submit_tag "Filter" %>
<% end %>
<%= link_to "Clear Filters", code_tickets_path %>

<dl>
<% @tickets.each_with_index do |ticket, i| %>
  <dt><%= i + 1 %>: <%= link_to(ticket.name, ticket) %> (<%= ticket.vote_count %>)
  <% if params[:status].blank? || ["open", "all"].include?(params[:status]) %>
    [<%= ticket.status %>]
  <% end %>
  </dt>
  <dd><%=raw ticket.summary %></dd>
<% end %>
</dl>
