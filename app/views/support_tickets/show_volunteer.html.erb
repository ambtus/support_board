<%= form_for(@ticket) do |t| %>
  <p class="submit">
    <%= t.submit (@ticket.pseud == current_user.support_pseud ? "Untake" : "Take") %>
    <%= label_tag :pseud_id, "Support Volunteers" %>:
       <%= select_tag :pseud_id, options_for_select(Pseud.where(:support_volunteer => true).collect {|p| [ p.name, p.id ] }) %>
    <%= t.submit "Send request to take" %>
    <br \>
    <% unless @ticket.user %>
      <%= t.submit (@ticket.approved? ? "Spam" : "Ham") %>
    <% end %>
    <%= t.submit (@ticket.comment? ? "Needs Attention" : "Comment") %>
    <% unless @ticket.admin %>
      <%= t.submit "Needs Admin Attention" %>
    <% end %>
    <% if current_user.support_admin %>
      <%= t.submit (@ticket.admin_resolved? ? "Unresolve" : "Admin Resolved") %>
    <% end %>
    <dt><%= t.label :code_ticket_id, "Code Ticket" %>:</dt>
      <dd><%= t.select :code_ticket_id, CodeTicket.where(:resolved => false).collect {|p| [ p.name, p.id ] }, :selected => @ticket.code_ticket_id %></dd>
    <% if @ticket.code_ticket_id? %>
      <%= t.submit "Remove link to Code ticket" %>
    <% else %>
      <%= t.submit "Link to Code ticket" %>
      <%= t.submit "Create new Code ticket" %>
    <% end %>
    <dt><%= t.label :archive_faq_id, "FAQ" %>:</dt>
      <dd><%= t.select :archive_faq_id, ArchiveFaq.order(:position).collect {|p| [ p.name, p.id ] }, :selected => @ticket.archive_faq_id %></dd>
    <% if @ticket.archive_faq_id? %>
      <%= t.submit "Remove link to FAQ" %>
    <% else %>
      <%= t.submit "Link to FAQ" %>
      <%= t.submit "Create new FAQ" %>
    <% end %>
  </p>
  <p>
    <% if @ticket.being_watched?(current_user) %>
      <%= t.check_box :turn_off_notifications %>
      <%= t.label :turn_off_notifications, "Turn off notifications"%>
    <% else %>
      <%= t.check_box :turn_on_notifications %>
      <%= t.label :turn_on_notifications, "Turn on notifications"%>
    <% end %>
  </p>
  <% unless @ticket.private %>
    <p>
      <%= t.check_box :private %>
      <%= t.label :private, "Private. (Ticket will only be visible to owner and official Support volunteers. This cannot be undone.)"%>
    </p>
  <% end %>
  <dl>
    <% if @ticket.display_user_name %>
      <dt><%= "User" %>:</dt>
        <dd><%= link_to @ticket.user.login, @ticket.user %></dd>
    <% end %>
    <dt><%= "Access" %>:</dt>
      <dd><%= @ticket.private? ? "Private" : "Public" %>
    <dt><%= "Status" %>:</dt>
      <dd><%= @ticket.status_line %>
          <% if @ticket.archive_faq_id %>
            <%= link_to @ticket.archive_faq.name, @ticket.archive_faq %>
          <% end %>
      </dd>
    <dt><%= "Summary" %>:</dt>
      <dd><%= raw @ticket.summary %></dd>

    <%= t.fields_for :support_details do |d| %>
      <% if d.object.new_record? %>
        <dt><%= d.label :pseud_id, "Pseud (Will be visible). If you don't use your support pseud, this comment will not be marked official" %>:</dt>
          <dd><%= d.select :pseud_id, current_user.pseuds.collect {|p| [ p.name, p.id ] }, :selected => current_user.support_pseud.id %></dd>
        <dt><%= d.label :content, "Add details" %>:</dt>
          <dd><%= d.text_area :content %></dd>
      <% else %>
        <% if d.object.resolved_ticket? %>
          <dt><%= "Answered by" %> <%= d.object.byline %>:</dt>
        <% else %>
          <dt><%= d.object.byline %> <%= "wrote" %>:</dt>
        <% end %>
            <dd><%= raw d.object.content %></dd>
      <% end %>
    <% end %>

  </dl>
  <p class="submit">
    <%= t.submit %>
  </p>
<% end %>
